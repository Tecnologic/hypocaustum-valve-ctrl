<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="DoxyPress 1.7.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>modm API documentation: Blocking Delays</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxypress.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="custom_dark_theme.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by DoxyPress -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">modm API documentation
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by DoxyPress 1.7.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__modm__architecture__delay.html',''); initResizable(); });
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
    <div class="title">Blocking Delays<div class="ingroups"><a class="el" href="group__modm__architecture.html">Architecture Interfaces</a></div></div>
  </div>
  <div class="clear-floats"></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="memitem:ga54f2f418bfd40b39a5475c1ec46f5e7a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__modm__architecture__delay.html#ga54f2f418bfd40b39a5475c1ec46f5e7a">modm::delay</a> (std::chrono::nanoseconds ns)</td></tr>
<tr class="separator:ga54f2f418bfd40b39a5475c1ec46f5e7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga75fe0c0a7c4d50fc0e25b8e5e7a633db"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga75fe0c0a7c4d50fc0e25b8e5e7a633db"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>modm::delay_ns</b> (uint32_t ns)</td></tr>
<tr class="separator:ga75fe0c0a7c4d50fc0e25b8e5e7a633db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac1b621b4537928f95a84fad677b199ce"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__modm__architecture__delay.html#gac1b621b4537928f95a84fad677b199ce">modm::delay</a> (std::chrono::microseconds us)</td></tr>
<tr class="separator:gac1b621b4537928f95a84fad677b199ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae4581936c87312fddf7edfa7035f888e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gae4581936c87312fddf7edfa7035f888e"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>modm::delay_us</b> (uint32_t us)</td></tr>
<tr class="separator:gae4581936c87312fddf7edfa7035f888e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad8b7a30b3952ba10c8f3677ab53a7931"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gad8b7a30b3952ba10c8f3677ab53a7931"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__modm__architecture__delay.html#gad8b7a30b3952ba10c8f3677ab53a7931">modm::delay</a> (std::chrono::milliseconds ms)</td></tr>
<tr class="memdesc:gad8b7a30b3952ba10c8f3677ab53a7931"><td class="mdescLeft">&#160;</td><td class="mdescRight">Spin for milliseconds. <br /></td></tr>
<tr class="separator:gad8b7a30b3952ba10c8f3677ab53a7931"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0c7344e467523431ea9af1ec092e1a71"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga0c7344e467523431ea9af1ec092e1a71"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>modm::delay_ms</b> (uint32_t ms)</td></tr>
<tr class="separator:ga0c7344e467523431ea9af1ec092e1a71"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>lbuild module: <code>modm:architecture:delay</code></p>
<p>These functions allow you to spin for a short time using only the CPU.</p>
<p>In general it is recommended to use the <code>std::chrono</code> duration types to allow the compiler to choose the optimal implementation for you:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;chrono&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">constexpr</span> std::chrono::nanoseconds DELAY_TIME{100};</div>
<div class="line"><a class="code" href="group__modm__architecture__delay.html#gad8b7a30b3952ba10c8f3677ab53a7931">modm::delay</a>(DELAY_TIME);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">constexpr</span> std::chrono::microseconds DELAY_TIME2{200};</div>
<div class="line"><a class="code" href="group__modm__architecture__delay.html#gad8b7a30b3952ba10c8f3677ab53a7931">modm::delay</a>(DELAY_TIME2); <span class="comment">// same signature, different implementation</span></div>
</div><!-- end fragment -->
<p>In your code you can also use the <code>std::chrono</code> literals:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span>std::chrono_literals;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__modm__architecture__delay.html#gad8b7a30b3952ba10c8f3677ab53a7931">modm::delay</a>(100ns);</div>
<div class="line"><a class="code" href="group__modm__architecture__delay.html#gad8b7a30b3952ba10c8f3677ab53a7931">modm::delay</a>(200us);</div>
<div class="line"><a class="code" href="group__modm__architecture__delay.html#gad8b7a30b3952ba10c8f3677ab53a7931">modm::delay</a>(300ms);</div>
<div class="line"><a class="code" href="group__modm__architecture__delay.html#gad8b7a30b3952ba10c8f3677ab53a7931">modm::delay</a>(400s);</div>
</div><!-- end fragment -->
<p>In order to not require wild casting around of values, there are also three overloads for (unsigned) integer values. These are particularly useful for when you do not want to or cannot use chrono literals.</p>
<div class="fragment"><div class="line">modm::delay_ns(100);</div>
<div class="line">modm::delay_us(200);</div>
<div class="line">modm::delay_ms(300);</div>
</div><!-- end fragment -->
<p>Note that these delay functions work at any CPU clock speed, even if changed dynamically at runtime and are available very early in the startup process at hardware-init time.</p>
<h2>Limitations</h2>
<p>The main limitations are accuracy and length of delay. The only guarantee given to you is to delay for <em>at least</em> the specified time. Note that invocation of interrupts during spinning may add delay too.</p>
<ul>
<li><code>modm::delay(ns)</code> guarantees at most 1'000'000ns = 1ms delay.</li>
<li><code>modm::delay(us)</code> guarantees at most 1'000'000Âµs = 1s delay.</li>
<li><code>modm::delay(ms)</code> is limited to 49 days.</li>
</ul>
<p>Please note that the delay these functions provide is defined as the time from invocation to the time of execution return. Obviously no delay beyond that is considered, which may require you to use shorter delays to compensate for the overhead of your code:</p>
<div class="fragment"><div class="line"><span class="keywordflow">do</span> <span class="comment">// GpioA4 toggling takes longer than 500ns because:</span></div>
<div class="line">{</div>
<div class="line">    modm::delay_ns(500); <span class="comment">// takes ~500ns</span></div>
<div class="line">    GpioA4::toggle();    <span class="comment">// takes a few cycles</span></div>
<div class="line">} <span class="keywordflow">while</span>(1);              <span class="comment">// jump back to loop also takes a few cycles</span></div>
</div><!-- end fragment -->
<p>You should always prefer Software Timers (see <code>modm:processing:timer</code>) over these <em>blocking</em> delay functions. However, when <code>modm::Clock</code> is not set up yet, or when you need very small delays (for example to bit-bang a protocol), you need to use these delay functions.</p>
<p>For the technical details on the delay implementations you can <a href="https://blog.salkinium.com/modm-delay">read "Accurate Micro- and Nanosecond Delay in modm"</a>. </p>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gac1b621b4537928f95a84fad677b199ce"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void modm::delay </td>
          <td>(</td>
          <td class="paramtype">std::chrono::microseconds&#160;</td>
          <td class="paramname"><em>us</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Spin for microseconds.</p>
<dl class="section warning"><dt>Warning</dt><dd>The maximum delay is 1'000'000us = 1 second. Use milliseconds for longer delays.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>In debug mode this function may raise "delay.us" if input validation fails. </dd></dl>

</div>
</div>
<a class="anchor" id="gac1b621b4537928f95a84fad677b199ce"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void modm::delay </td>
          <td>(</td>
          <td class="paramtype">std::chrono::microseconds&#160;</td>
          <td class="paramname"><em>us</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Spin for microseconds.</p>
<dl class="section warning"><dt>Warning</dt><dd>The maximum delay is 1'000'000us = 1 second. Use milliseconds for longer delays.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>In debug mode this function may raise "delay.us" if input validation fails. </dd></dl>

</div>
</div>
<a class="anchor" id="ga54f2f418bfd40b39a5475c1ec46f5e7a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void modm::delay </td>
          <td>(</td>
          <td class="paramtype">std::chrono::nanoseconds&#160;</td>
          <td class="paramname"><em>ns</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Spin for nanoseconds.</p>
<dl class="section warning"><dt>Warning</dt><dd>This function is implemented as best-effort and its resolution will be very coarse especially on platforms with very slow clocks.</dd>
<dd>
The maximum delay is 1'000'000ns = 1 millisecond. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for DoxyPress 1.3.7-->
<!-- Generated by DoxyPress 1.7.0 -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.copperspice.com/documentation-doxypress.html">
    <img class="footer" src="doxypress.png" alt="DoxyPress"/></a> 1.7.0 </li>
  </ul>
</div>
<script>
if (window.location.href.includes("modm.io")) {
 var device = /\/api\/([a-zA-Z0-9_-]+)\//.exec(window.location.href)[1].toUpperCase();
 document.title = document.title.replace("modm API documentation", "modm API documentation for " + device);
 document.getElementById('projectname').innerHTML = document.getElementById('projectname').innerHTML.replace("modm API documentation", "modm API documentation for " + device);
}
document.getElementById('MSearchResults').onload = function()
{
  var iframe = document.getElementById('MSearchResults').contentWindow.document;
  var head = iframe.getElementsByTagName("head")[0];
  var link = iframe.createElement("link");
  link.setAttribute("rel", "stylesheet");
  link.setAttribute("type", "text/css");
  link.setAttribute("href", "../custom.css");
  head.appendChild(link);
  var link = iframe.createElement("link");
  link.setAttribute("rel", "stylesheet");
  link.setAttribute("type", "text/css");
  link.setAttribute("href", "../custom_dark_theme.css");
  head.appendChild(link);
}
</script>
</body>
</html>
